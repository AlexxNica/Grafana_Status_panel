{"version":3,"sources":["../src/status_ctrl.js"],"names":["MetricsPanelCtrl","_","TimeSeries","coreModule","kbn","moment","StatusPluginCtrl","$scope","$injector","$log","$filter","annotationsSrv","filter","valueHandlers","aggregations","displayTypes","each","panel","targets","t","valueHandler","crit","Date","warn","flipTime","events","on","onRender","bind","postRefresh","onDataError","onDataReceived","onInitEditMode","addFilters","numberOrTextFilter","input","angular","isNumber","$stateful","textRegex","length","regex","RegExp","e","matchResults","match","fixedSpan","span","measurements","duplicates","measurement","hide","m","res","alias","target","addEditorTab","unitFormats","getUnitFormats","subItem","units","value","render","$panelContainer","find","css","$panelContoller","height","minHeight","tail","panelWidth","innerWidth","isNaN","parseInt","slice","maxWidth","Number","undefined","String","c","w","getTime","setElementHeight","setTextMaxWidth","upgradeOldVersion","clusterName","displayName","replace","namePrefix","flipCard","addClass","removeClass","disabled","display","annotation","extraMoreAlerts","series","s","url","displayType","valueDisplayRegex","validateRegex","aggregation","max","datapoints","point","stats","min","total","avg","display_value","handleThresholdStatus","handleDisabledStatus","handleTextOnly","isHideAlertsOnDisable","autoFlip","handleCssDisplay","parseUri","handleMaxAlertsToShow","isFloat","thresholds","parseThresholds","inverted","isCritical","isWarning","isCheckRanges","warnIsNumber","critIsNumber","formatDisplayValue","push","isFinite","decimals","Math","floor","toString","split","valueFormats","date","dashboard","isTimezoneUtc","utc","format","dateFormat","disabledValue","isGrayOnNoData","useDefaultBackground","maxAlertNumber","currentMaxAllowedAlerts","filteredOutAlerts","arrayNamesToSlice","forEach","originAlertCount","arrayName","links","link","type","uri","dashUri","params","targetBlank","dataList","map","seriesHandler","timeoutId","clearInterval","setInterval","toggleClass","scope","elem","attrs","ctrl","metricOptions","parseFloat","valueOf","val","toLowerCase","indexOf","seriesData","flotpairs","getFlotPairs","templateUrl"],"mappings":"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","file":"status_ctrl.js","sourcesContent":["﻿import {MetricsPanelCtrl} from \"app/plugins/sdk\";\r\nimport \"app/plugins/panel/graph/legend\";\r\nimport \"app/plugins/panel/graph/series_overrides_ctrl\";\r\nimport _ from \"lodash\";\r\nimport TimeSeries from \"app/core/time_series2\";\r\nimport coreModule from \"app/core/core_module\";\r\nimport kbn from \"app/core/utils/kbn\";\r\nimport moment from \"moment\";\r\n\r\nimport './css/status_panel.css!';\r\n\r\nexport class StatusPluginCtrl extends MetricsPanelCtrl {\r\n\t/** @ngInject */\r\n\tconstructor($scope, $injector, $log, $filter, annotationsSrv) {\r\n\t\tsuper($scope, $injector);\r\n\r\n\t\t//this.log = $log.debug;\r\n\t\tthis.filter = $filter;\r\n\r\n\t\tthis.valueHandlers = ['Number Threshold', 'String Threshold', 'Date Threshold', 'Disable Criteria', 'Text Only'];\r\n\t\tthis.aggregations = ['Last', 'First', 'Max', 'Min', 'Sum', 'Avg'];\r\n\t\tthis.displayTypes = ['Regular', 'Annotation'];\r\n\r\n\t\t// Dates get stored as strings and will need to be converted back to a Date objects\r\n\t\t_.each(this.panel.targets, (t) => {\r\n\t\t\tif (t.valueHandler === \"Date Threshold\") {\r\n\t\t\t\tif (typeof t.crit != \"undefined\") t.crit = new Date(t.crit);\r\n\t\t\t\tif (typeof t.warn != \"undefined\") t.warn = new Date(t.warn);\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\tthis.panel.flipTime = this.panel.flipTime || 5;\r\n\r\n\t\t/** Bind events to functions **/\r\n\t\tthis.events.on('render', this.onRender.bind(this));\r\n\t\tthis.events.on('refresh', this.postRefresh.bind(this));\r\n\t\tthis.events.on('data-error', this.onDataError.bind(this));\r\n\t\tthis.events.on('data-received', this.onDataReceived.bind(this));\r\n\t\tthis.events.on('data-snapshot-load', this.onDataReceived.bind(this));\r\n\t\tthis.events.on('init-edit-mode', this.onInitEditMode.bind(this));\r\n\r\n\t\tthis.addFilters()\r\n\t}\r\n\r\n\taddFilters() {\r\n\t\tcoreModule.filter('numberOrText', () => {\r\n\t\t\tlet numberOrTextFilter = (input) => {\r\n\t\t\t\tif(angular.isNumber(input)) {\r\n\t\t\t\t\treturn this.filter('number')(input);\r\n\t\t\t\t} else {\r\n\t\t\t\t\treturn input;\r\n\t\t\t\t}\r\n\t\t\t};\r\n\r\n\t\t\tnumberOrTextFilter.$stateful = true;\r\n\t\t\treturn numberOrTextFilter;\r\n\t\t});\r\n\r\n\t\tcoreModule.filter('numberOrTextWithRegex', () => {\r\n\t\t\tlet numberOrTextFilter = (input, textRegex) => {\r\n\t\t\t\tif(angular.isNumber(input)) {\r\n\t\t\t\t\treturn this.filter('number')(input);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tif(textRegex == null || textRegex.length == 0) {\r\n\t\t\t\t\t\treturn input;\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tlet regex;\r\n\r\n\t\t\t\t\t\ttry {\r\n\t\t\t\t\t\t\tregex = new RegExp(textRegex);\r\n\t\t\t\t\t\t} catch (e) {\r\n\t\t\t\t\t\t\treturn input;\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tif (!input) {\r\n\t\t\t\t\t\t\treturn input;\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tlet matchResults = input.match(regex);\r\n\t\t\t\t\t\tif (matchResults == null) {\r\n\t\t\t\t\t\t\treturn input;\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\treturn matchResults[0];\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t};\r\n\r\n\t\t\tnumberOrTextFilter.$stateful = true;\r\n\t\t\treturn numberOrTextFilter;\r\n\t\t});\r\n\t}\r\n\r\n\tpostRefresh() {\r\n\t\tif (this.panel.fixedSpan) {\r\n\t\t\tthis.panel.span = this.panel.fixedSpan;\r\n\t\t}\r\n\r\n\t\tthis.measurements = this.panel.targets;\r\n\r\n\t\t/** Duplicate alias validation **/\r\n\t\tthis.duplicates = false;\r\n\r\n\t\tthis.measurements = _.filter(this.measurements, (measurement) => {\r\n\t\t\treturn !measurement.hide;\r\n\t\t});\r\n\r\n\t\t_.each(this.measurements, (m) => {\r\n\t\t\tlet res = _.filter(this.measurements, (measurement) => {\r\n\t\t\t\treturn (m.alias == measurement.alias || (m.target == measurement.target && m.target)) && !m.hide;\r\n\t\t\t});\r\n\r\n\t\t\tif (res.length > 1) {\r\n\t\t\t\tthis.duplicates = true;\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\r\n\tonInitEditMode() {\r\n        this.addEditorTab('Options', 'public/plugins/vonage-status-panel/editor.html', 2);\r\n\t\t// Load in the supported units-of-measure formats so they can be displayed in the editor\r\n\t\tthis.unitFormats = kbn.getUnitFormats();\r\n\t}\r\n\r\n    setUnitFormat(measurement, subItem) {\r\n\t\tmeasurement.units = subItem.value;\r\n\t\tthis.render();\r\n\t}\r\n\r\n\tsetElementHeight() {\r\n\t\tthis.$panelContainer.find('.status-panel').css('min-height', this.$panelContoller.height + 'px');\r\n\t\tthis.minHeight = this.$panelContoller.height-10;\r\n\t}\r\n\r\n\tsetTextMaxWidth() {\r\n\t\tlet tail = ' …';\r\n\t\tlet panelWidth = this.$panelContainer.innerWidth();\r\n\t\tif (isNaN(panelWidth))\r\n\t\t\tpanelWidth = parseInt(panelWidth.slice(0, -2), 10) / 12;\r\n\t\tpanelWidth = panelWidth - 20;\r\n\t\tthis.maxWidth = panelWidth;\r\n\t}\r\n\r\n\tonHandlerChange(measurement) {\r\n\t\t// If the Threshold type changes between Number/String/Date then try and recast the thresholds to keep consistent\r\n\t\tif (measurement.valueHandler === \"Number Threshold\") {\r\n\t\t\tmeasurement.crit = (isNaN(Number(measurement.crit))) ? undefined : Number(measurement.crit);\r\n\t\t\tmeasurement.warn = (isNaN(Number(measurement.warn))) ? undefined : Number(measurement.warn);\r\n\t\t} else if (measurement.valueHandler === \"String Threshold\") {\r\n\t\t\tif (typeof measurement.crit != \"undefined\") measurement.crit = String(measurement.crit);\r\n\t\t\tif (typeof measurement.warn != \"undefined\") measurement.warn = String(measurement.warn);\r\n\t\t} else if (measurement.valueHandler === \"Date Threshold\") {\r\n\t\t\tlet c = new Date(measurement.crit), w = new Date(measurement.warn);\r\n\t\t\tmeasurement.crit = (isNaN(c.getTime())) ? undefined : c;\r\n\t\t\tmeasurement.warn = (isNaN(w.getTime())) ? undefined : w;\r\n\t\t}\r\n\t\tthis.onRender();\r\n\t}\r\n\r\n\tonRender() {\r\n\t\tthis.setElementHeight();\r\n\t\tthis.setTextMaxWidth();\r\n\t\tthis.upgradeOldVersion();\r\n\r\n\t\tif (this.panel.clusterName) {\r\n\t\t\tthis.panel.displayName =\r\n\t\t\t\tthis.filter('interpolateTemplateVars')(this.panel.clusterName, this.$scope)\r\n\t\t\t\t\t.replace(new RegExp(this.panel.namePrefix, 'i'), '');\r\n\t\t} else {\r\n\t\t\tthis.panel.displayName = \"\";\r\n\t\t}\r\n\r\n\t\tif(this.panel.flipCard){\r\n\t\t  this.$panelContainer.addClass(\"effect-hover\");\r\n\t\t} else {\r\n\t\t  this.$panelContainer.removeClass(\"effect-hover\");\r\n\t\t}\r\n\r\n\t\tlet targets = this.panel.targets;\r\n\r\n\t\tthis.crit = [];\r\n\t\tthis.warn = [];\r\n\t\tthis.disabled = [];\r\n\t\tthis.display = [];\r\n\t\tthis.annotation = [];\r\n\t\tthis.extraMoreAlerts = null;\r\n\r\n\t\t_.each(this.series, (s) => {\r\n\t\t\tlet target = _.find(targets, (target) => {\r\n\t\t\t\treturn target.alias == s.alias || target.target == s.alias;\r\n\t\t\t});\r\n\r\n\t\t\tif (!target) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\ts.alias = target.alias;\r\n\t\t\ts.url = target.url;\r\n\t\t\ts.display = true;\r\n\t\t\ts.displayType = target.displayType;\r\n\t\t\ts.valueDisplayRegex = \"\";\r\n\r\n\t\t\tif(this.validateRegex(target.valueDisplayRegex)) {\r\n\t\t\t\ts.valueDisplayRegex = target.valueDisplayRegex;\r\n\t\t\t}\r\n\r\n\t\t\tlet value;\r\n\t\t\tswitch (target.aggregation) {\r\n\t\t\t\tcase 'Max':\r\n\t\t\t\t\tvalue = _.max(s.datapoints, (point) => { return point[0]; })[0];\r\n\t\t\t\t\tvalue = s.stats.max;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 'Min':\r\n\t\t\t\t\tvalue = _.min(s.datapoints, (point) => { return point[0]; })[0];\r\n\t\t\t\t\tvalue = s.stats.min;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 'Sum':\r\n\t\t\t\t\tvalue = 0;\r\n\t\t\t\t\t_.each(s.datapoints, (point) => { value += point[0] });\r\n\t\t\t\t\tvalue = s.stats.total;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 'Avg':\r\n\t\t\t\t\tvalue = s.stats.avg;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 'First':\r\n\t\t\t\t\tvalue = s.datapoints[0][0];\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tdefault:\r\n\t\t\t\t\tvalue = s.datapoints[s.datapoints.length - 1][0];\r\n\t\t\t}\r\n\r\n\t\t\ts.display_value = value;\r\n\r\n\t\t\tif (target.valueHandler == \"Number Threshold\" ||\r\n\t\t\t\ttarget.valueHandler == \"String Threshold\" ||\r\n\t\t\t\ttarget.valueHandler == \"Date Threshold\") {\r\n\t\t\t\tthis.handleThresholdStatus(s, target);\r\n\t\t\t}\r\n\t\t\telse if (target.valueHandler == \"Disable Criteria\") {\r\n\t\t\t\tthis.handleDisabledStatus(s,target);\r\n\t\t\t}\r\n\t\t\telse if (target.valueHandler == \"Text Only\") {\r\n\t\t\t\tthis.handleTextOnly(s, target);\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\tif(this.panel.isHideAlertsOnDisable && this.disabled.length > 0) {\r\n\t\t\tthis.crit = [];\r\n\t\t\tthis.warn = [];\r\n\t\t\tthis.display = [];\r\n\t\t}\r\n\r\n\t\tthis.autoFlip();\r\n\t\tthis.handleCssDisplay();\r\n\t\tthis.parseUri();\r\n\r\n\t\t//This must appear after handling the css style of the panel\r\n\t\tthis.handleMaxAlertsToShow();\r\n\t}\r\n\r\n\tupgradeOldVersion() {\r\n\t\tlet targets = this.panel.targets;\r\n\r\n\t\t//Handle legacy code\r\n\t\t_.each(targets, (target) => {\r\n\t\t\tif(target.valueHandler == null) {\r\n\t\t\t\ttarget.valueHandler = target.displayType;\r\n\t\t\t\tif(target.valueHandler == \"Annotation\") {\r\n\t\t\t\t\ttarget.valueHandler = \"Text Only\"\r\n\t\t\t\t}\r\n\t\t\t\ttarget.displayType = this.displayTypes[0];\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\t// Depreciate Threshold in favour of Type specific versions\r\n\t\t_.each(targets, (target) => {\r\n\t\t\tif (target.valueHandler === \"Threshold\") {\r\n\t\t\t\t// Use the same logic as Threshold Parsing to ensure we retain same behaviour\r\n\t\t\t\t// i.e. map to Number Threshold if two floats (i.e. range check) otherwise map to String Threshold (i.e. exact match)\r\n\t\t\t\tif (StatusPluginCtrl.isFloat(target.crit) && StatusPluginCtrl.isFloat(target.warn)) {\r\n\t\t\t\t\ttarget.valueHandler = \"Number Threshold\"\r\n\t\t\t\t\ttarget.crit = Number(target.crit);\r\n\t\t\t\t\ttarget.warn = Number(target.warn);\r\n\t\t\t\t} else {\r\n\t\t\t\t\ttarget.valueHandler = \"String Threshold\"\r\n\t\t\t\t\tif (typeof target.crit != \"undefined\") target.crit = String(target.crit);\r\n\t\t\t\t\tif (typeof target.warn != \"undefined\") target.warn = String(target.warn);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\r\n\thandleThresholdStatus(series, target) {\r\n\t\tseries.thresholds = StatusPluginCtrl.parseThresholds(target);\r\n\t\tseries.inverted = series.thresholds.crit < series.thresholds.warn;\r\n\t\tseries.display = target.display;\r\n\r\n\t\tlet isCritical = false;\r\n\t\tlet isWarning = false;\r\n\t\tlet isCheckRanges = series.thresholds.warnIsNumber && series.thresholds.critIsNumber;\r\n\t\tif (isCheckRanges) {\r\n\t\t\tif (!series.inverted) {\r\n\t\t\t\tif (series.display_value >= series.thresholds.crit) {\r\n\t\t\t\t\tisCritical = true\r\n\t\t\t\t} else if (series.display_value >= series.thresholds.warn) {\r\n\t\t\t\t\tisWarning = true\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tif (series.display_value <= series.thresholds.crit) {\r\n\t\t\t\t\tisCritical = true\r\n\t\t\t\t} else if (series.display_value <= series.thresholds.warn) {\r\n\t\t\t\t\tisWarning = true\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tif (series.display_value == series.thresholds.crit) {\r\n\t\t\t\tisCritical = true\r\n\t\t\t} else if (series.display_value == series.thresholds.warn) {\r\n\t\t\t\tisWarning = true\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// Add units-of-measure and decimal formatting or date formatting as needed\r\n\t\tseries.display_value = this.formatDisplayValue(series.display_value, target);\r\n\r\n\t\tif(isCritical) {\r\n\t\t\tthis.crit.push(series);\r\n\t\t\tseries.displayType = this.displayTypes[0]\r\n\t\t} else if(isWarning) {\r\n\t\t\tthis.warn.push(series);\r\n\t\t\tseries.displayType = this.displayTypes[0]\r\n\t\t} else if (series.display) {\r\n\t\t\tif(series.displayType == \"Annotation\") {\r\n\t\t\t\tthis.annotation.push(series);\r\n\t\t\t} else {\r\n\t\t\t\tthis.display.push(series);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tformatDisplayValue(value, target) {\r\n\t\t// Format the display value. Set to \"Invalid\" if value is out-of-bounds or a type mismatch with the handler\r\n\t\tif (target.valueHandler === \"Number Threshold\") {\r\n\t\t\tif (_.isFinite(value)) {\r\n\t\t\t\tlet units = (typeof target.units === \"string\") ? target.units : 'none';\r\n\t\t\t\tlet decimals = (Math.floor(value) === value) ? 0 : value.toString().split(\".\")[1].length;\r\n\t\t\t\tdecimals = (typeof target.decimals === \"number\") ? target.decimals : decimals;\r\n\t\t\t\tvalue = kbn.valueFormats[units](value, decimals, null);\r\n\t\t\t} else {\r\n\t\t\t\tvalue = \"Invalid Number\";\r\n\t\t\t}\r\n\t\t} else if (target.valueHandler === \"String Threshold\") {\r\n\t\t\tif (value === undefined || value === null || value !== value)\r\n\t\t\t\tvalue = \"Invalid String\";\r\n\t\t} else if (target.valueHandler === \"Date Threshold\") {\r\n\t\t\tif (_.isFinite(value)) {\r\n\t\t\t\tlet date = moment(new Date(value));\r\n\t\t\t\tif (this.dashboard.isTimezoneUtc()) date = date.utc();\r\n\t\t\t\tvalue = date.format(target.dateFormat);\r\n\t\t\t} else {\r\n\t\t\t\tvalue = \"Invalid Date\";\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn value;\r\n\t}\r\n\r\n\thandleDisabledStatus(series, target) {\r\n\t\tseries.displayType = this.displayTypes[0];\r\n\t\tseries.disabledValue = target.disabledValue;\r\n\r\n\t\tif (series.display_value == series.disabledValue) {\r\n\t\t\tthis.disabled.push(series);\r\n\t\t}\r\n\t}\r\n\r\n\thandleTextOnly(series, target) {\r\n\t\tif(series.displayType == \"Annotation\") {\r\n\t\t\tthis.annotation.push(series);\r\n\t\t} else {\r\n\t\t\tthis.display.push(series);\r\n\t\t}\r\n\t}\r\n\r\n\thandleCssDisplay() {\r\n\t\tthis.$panelContainer.removeClass('error-state warn-state disabled-state ok-state no-data-state default-background');\r\n\r\n\t\tif(this.duplicates) {\r\n\t\t\tthis.$panelContainer.addClass('error-state');\r\n\t\t} else if (this.disabled.length > 0) {\r\n\t\t\tthis.$panelContainer.addClass('disabled-state');\r\n\t\t} else if (this.crit.length > 0) {\r\n\t\t\tthis.$panelContainer.addClass('error-state');\r\n\t\t} else if (this.warn.length > 0) {\r\n\t\t\tthis.$panelContainer.addClass('warn-state');\r\n\t\t} else if((this.series == undefined || this.series.length == 0) && this.panel.isGrayOnNoData) {\r\n\t\t\tthis.$panelContainer.addClass('no-data-state');\r\n\t\t} else {\r\n\t\t\tthis.$panelContainer.addClass('ok-state');\r\n\t\t\tif (this.panel.useDefaultBackground)\r\n\t\t\t\tthis.$panelContainer.addClass('default-background');\r\n\t\t}\r\n\t}\r\n\r\n\thandleMaxAlertsToShow() {\r\n\t\tif(this.panel.maxAlertNumber != null && this.panel.maxAlertNumber >= 0) {\r\n\t\t\tlet currentMaxAllowedAlerts = this.panel.maxAlertNumber;\r\n\t\t\tlet filteredOutAlerts = 0;\r\n\t\t\tlet arrayNamesToSlice = [\"disabled\", \"crit\", \"warn\", \"display\"];\r\n\t\t\tarrayNamesToSlice.forEach( arrayName => {\r\n\t\t\t\tlet originAlertCount = this[arrayName].length;\r\n\t\t\t\tthis[arrayName] = this[arrayName].slice(0,currentMaxAllowedAlerts);\r\n\t\t\t\tcurrentMaxAllowedAlerts = Math.max(currentMaxAllowedAlerts - this[arrayName].length, 0);\r\n\t\t\t\tfilteredOutAlerts += (originAlertCount - this[arrayName].length);\r\n\t\t\t});\r\n\r\n\t\t\tif(filteredOutAlerts > 0) {\r\n\t\t\t\tthis.extraMoreAlerts = \"+ \" + filteredOutAlerts + \" more\"\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tparseUri() {\r\n\t\tif (this.panel.links && this.panel.links.length > 0) {\r\n\t\t\tlet link = this.panel.links[0];\r\n\r\n\t\t\tif (link.type == \"absolute\") {\r\n\t\t\t\tthis.uri = link.url;\r\n\t\t\t} else {\r\n\t\t\t\tthis.uri = 'dashboard/' + link.dashUri;\r\n\t\t\t}\r\n\r\n\t\t\tif (link.params) {\r\n\t\t\t\tthis.uri +=  \"?\" + link.params;\r\n\t\t\t}\r\n\r\n\t\t\tthis.targetBlank = link.targetBlank;\r\n\t\t} else {\r\n\t\t\tthis.uri = undefined;\r\n\t\t}\r\n\t}\r\n\r\n\tvalidateRegex(textRegex) {\r\n\t\tif(textRegex == null || textRegex.length == 0) {\r\n\t\t\treturn true\r\n\t\t}\r\n\t\ttry {\r\n\t\t\tlet regex = new RegExp(textRegex);\r\n\t\t\treturn true\r\n\t\t} catch(e) {\r\n\t\t\treturn false\r\n\t\t}\r\n\t}\r\n\r\n\tstatic parseThresholds(metricOptions) {\r\n\t\tlet res = {};\r\n\r\n\t\tif (StatusPluginCtrl.isFloat(metricOptions.warn)) {\r\n\t\t\tres.warn = parseFloat(metricOptions.warn);\r\n\t\t\tres.warnIsNumber = true;\r\n\t\t} else if (metricOptions.warn instanceof Date) {\r\n\t\t\t// Convert Dates to Numbers and leverage existing threshold logic\r\n\t\t\tres.warn = metricOptions.warn.valueOf();\r\n\t\t\tres.warnIsNumber = true;\r\n\t\t} else {\r\n\t\t\tres.warn = metricOptions.warn;\r\n\t\t\tres.warnIsNumber = false;\r\n\t\t}\r\n\r\n\t\tif (StatusPluginCtrl.isFloat(metricOptions.crit)) {\r\n\t\t\tres.crit = parseFloat(metricOptions.crit);\r\n\t\t\tres.critIsNumber = true;\r\n\t\t} else if (metricOptions.crit instanceof Date) {\r\n\t\t\tres.crit = metricOptions.crit.valueOf();\r\n\t\t\tres.critIsNumber = true;\r\n\t\t} else {\r\n\t\t\tres.crit = metricOptions.crit;\r\n\t\t\tres.critIsNumber = false;\r\n\t\t}\r\n\r\n\t\treturn res;\r\n\t}\r\n\r\n\tstatic isFloat(val) {\r\n\t\tif (!isNaN(val) && val.toString().toLowerCase().indexOf('e') == -1) {\r\n\t\t\treturn true;\r\n\t\t}\r\n\t\treturn false;\r\n\t}\r\n\r\n\tonDataReceived(dataList) {\r\n\t\tthis.series = dataList.map(StatusPluginCtrl.seriesHandler.bind(this));\r\n\t\tthis.render();\r\n\t}\r\n\r\n\tonDataError() {\r\n\t\tthis.crit = [];\r\n\t\tthis.warn = [];\r\n\t}\r\n\r\n\tstatic seriesHandler(seriesData) {\r\n\t\tvar series = new TimeSeries({\r\n\t\t\tdatapoints: seriesData.datapoints,\r\n\t\t\talias: seriesData.target\r\n\t\t});\r\n\r\n\t\tseries.flotpairs = series.getFlotPairs(\"connected\");\r\n\r\n\t\treturn series;\r\n\t}\r\n\r\n\t$onDestroy() {\r\n\t\tif(this.timeoutId) clearInterval(this.timeoutId);\r\n\t}\r\n\r\n\tautoFlip() {\r\n\t\tif (this.timeoutId) clearInterval(this.timeoutId);\r\n\t\tif (this.panel.flipCard && (this.crit.length > 0 || this.warn.length > 0 || this.disabled.length > 0)) {\r\n\t\t\tthis.timeoutId = setInterval(() => {\r\n\t\t\t\tthis.$panelContainer.toggleClass(\"flipped\");\r\n\t\t\t}, this.panel.flipTime * 1000);\r\n\t\t}\r\n\t}\r\n\r\n\tlink(scope, elem, attrs, ctrl) {\r\n\t\tthis.$panelContainer = elem.find('.panel-container');\r\n\t\tthis.$panelContainer.addClass(\"st-card\");\r\n\t\tthis.$panelContoller = ctrl;\r\n\t}\r\n}\r\n\r\nStatusPluginCtrl.templateUrl = 'module.html';\r\n"]}