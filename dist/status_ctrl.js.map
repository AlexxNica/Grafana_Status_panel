{"version":3,"sources":["../src/status_ctrl.js"],"names":["MetricsPanelCtrl","_","TimeSeries","coreModule","StatusPluginCtrl","$scope","$injector","$log","$filter","annotationsSrv","filter","valueHandlers","aggregations","displayTypes","panel","flipTime","events","on","onRender","bind","postRefresh","onDataError","onDataReceived","onInitEditMode","addFilters","numberOrTextFilter","input","angular","isNumber","$stateful","textRegex","length","regex","RegExp","e","matchResults","match","fixedSpan","span","measurements","targets","duplicates","measurement","hide","each","m","res","alias","target","addEditorTab","$panelContainer","find","css","$panelContoller","height","minHeight","tail","panelWidth","innerWidth","isNaN","parseInt","slice","maxWidth","setElementHeight","setTextMaxWidth","upgradeOldVersion","clusterName","displayName","replace","namePrefix","flipCard","addClass","removeClass","crit","warn","disabled","display","annotation","series","s","url","displayType","valueDisplayRegex","validateRegex","value","aggregation","max","datapoints","point","stats","min","total","avg","display_value","valueHandler","handleThresholdStatus","handleDisabledStatus","handleTextOnly","autoFlip","handleCssDisplay","parseUri","thresholds","parseThresholds","inverted","isCritical","isWarning","isCheckRanges","warnIsNumber","critIsNumber","push","disabledValue","undefined","isGrayOnNoData","useDefaultBackground","links","uri","dashUri","params","dataList","map","seriesHandler","render","timeoutId","clearInterval","setInterval","toggleClass","scope","elem","attrs","ctrl","metricOptions","isFloat","parseFloat","val","toString","toLowerCase","indexOf","seriesData","flotpairs","getFlotPairs","templateUrl"],"mappings":"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","file":"status_ctrl.js","sourcesContent":["import {MetricsPanelCtrl} from \"app/plugins/sdk\";\r\nimport \"app/plugins/panel/graph/legend\";\r\nimport \"app/plugins/panel/graph/series_overrides_ctrl\";\r\nimport _ from \"lodash\";\r\nimport TimeSeries from \"app/core/time_series2\";\r\nimport coreModule from \"app/core/core_module\"\r\n\r\nimport './css/status_panel.css!';\r\n\r\nexport class StatusPluginCtrl extends MetricsPanelCtrl {\r\n\t/** @ngInject */\r\n\tconstructor($scope, $injector, $log, $filter, annotationsSrv) {\r\n\t\tsuper($scope, $injector);\r\n\r\n\t\t//this.log = $log.debug;\r\n\t\tthis.filter = $filter;\r\n\r\n\t\tthis.valueHandlers = ['Threshold', 'Disable Criteria', 'Text Only'];\r\n\t\tthis.aggregations = ['Last', 'First', 'Max', 'Min', 'Sum', 'Avg'];\r\n\t\tthis.displayTypes = ['Regular', 'Annotation'];\r\n\r\n\t\tthis.panel.flipTime = this.panel.flipTime || 5;\r\n\r\n\t\t/** Bind events to functions **/\r\n\t\tthis.events.on('render', this.onRender.bind(this));\r\n\t\tthis.events.on('refresh', this.postRefresh.bind(this));\r\n\t\tthis.events.on('data-error', this.onDataError.bind(this));\r\n\t\tthis.events.on('data-received', this.onDataReceived.bind(this));\r\n\t\tthis.events.on('data-snapshot-load', this.onDataReceived.bind(this));\r\n\t\tthis.events.on('init-edit-mode', this.onInitEditMode.bind(this));\r\n\r\n\t\tthis.addFilters()\r\n\t}\r\n\r\n\taddFilters() {\r\n\t\tcoreModule.filter('numberOrText', () => {\r\n\t\t\tlet numberOrTextFilter = (input) => {\r\n\t\t\t\tif(angular.isNumber(input)) {\r\n\t\t\t\t\treturn this.filter('number')(input);\r\n\t\t\t\t} else {\r\n\t\t\t\t\treturn input;\r\n\t\t\t\t}\r\n\t\t\t};\r\n\r\n\t\t\tnumberOrTextFilter.$stateful = true;\r\n\t\t\treturn numberOrTextFilter;\r\n\t\t});\r\n\r\n\t\tcoreModule.filter('numberOrTextWithRegex', () => {\r\n\t\t\tlet numberOrTextFilter = (input, textRegex) => {\r\n\t\t\t\tif(angular.isNumber(input)) {\r\n\t\t\t\t\treturn this.filter('number')(input);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tif(textRegex == null || textRegex.length == 0) {\r\n\t\t\t\t\t\treturn input;\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tlet regex;\r\n\r\n\t\t\t\t\t\ttry {\r\n\t\t\t\t\t\t\tregex = new RegExp(textRegex);\r\n\t\t\t\t\t\t} catch (e) {\r\n\t\t\t\t\t\t\treturn input;\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tlet matchResults = input.match(regex);\r\n\t\t\t\t\t\tif (matchResults == null) {\r\n\t\t\t\t\t\t\treturn input;\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\treturn matchResults[0];\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t};\r\n\r\n\t\t\tnumberOrTextFilter.$stateful = true;\r\n\t\t\treturn numberOrTextFilter;\r\n\t\t});\r\n\t}\r\n\r\n\tpostRefresh() {\r\n\t\tif (this.panel.fixedSpan) {\r\n\t\t\tthis.panel.span = this.panel.fixedSpan;\r\n\t\t}\r\n\r\n\t\tthis.measurements = this.panel.targets;\r\n\r\n\t\t/** Duplicate alias validation **/\r\n\t\tthis.duplicates = false;\r\n\r\n\t\tthis.measurements = _.filter(this.measurements, (measurement) => {\r\n\t\t\treturn !measurement.hide;\r\n\t\t});\r\n\r\n\t\t_.each(this.measurements, (m) => {\r\n\t\t\tlet res = _.filter(this.measurements, (measurement) => {\r\n\t\t\t\treturn (m.alias == measurement.alias || (m.target == measurement.target && m.target)) && !m.hide;\r\n\t\t\t});\r\n\r\n\t\t\tif (res.length > 1) {\r\n\t\t\t\tthis.duplicates = true;\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\r\n\tonInitEditMode() {\r\n\t\tthis.addEditorTab('Options', 'public/plugins/vonage-status-panel/editor.html', 2);\r\n\t}\r\n\r\n\tsetElementHeight() {\r\n\t\tthis.$panelContainer.find('.status-panel').css('min-height', this.$panelContoller.height + 'px');\r\n\t\tthis.minHeight = this.$panelContoller.height-10;\r\n\t}\r\n\r\n\tsetTextMaxWidth() {\r\n\t\tlet tail = ' …';\r\n\t\tlet panelWidth = this.$panelContainer.innerWidth();\r\n\t\tif (isNaN(panelWidth))\r\n\t\t\tpanelWidth = parseInt(panelWidth.slice(0, -2), 10) / 12;\r\n\t\tpanelWidth = panelWidth - 20;\r\n\t\tthis.maxWidth = panelWidth;\r\n\t}\r\n\r\n\tonRender() {\r\n\t\tthis.setElementHeight();\r\n\t\tthis.setTextMaxWidth();\r\n\t\tthis.upgradeOldVersion();\r\n\r\n\t\tif (this.panel.clusterName) {\r\n\t\t\tthis.panel.displayName =\r\n\t\t\t\tthis.filter('interpolateTemplateVars')(this.panel.clusterName, this.$scope)\r\n\t\t\t\t\t.replace(new RegExp(this.panel.namePrefix, 'i'), '');\r\n\t\t} else {\r\n\t\t\tthis.panel.displayName = \"\";\r\n\t\t}\r\n\r\n\t\tif(this.panel.flipCard){\r\n\t\t  this.$panelContainer.addClass(\"effect-hover\");\r\n\t\t} else {\r\n\t\t  this.$panelContainer.removeClass(\"effect-hover\");\r\n\t\t}\r\n\r\n\t\tlet targets = this.panel.targets;\r\n\r\n\t\tthis.crit = [];\r\n\t\tthis.warn = [];\r\n\t\tthis.disabled = [];\r\n\t\tthis.display = [];\r\n\t\tthis.annotation = [];\r\n\r\n\t\t_.each(this.series, (s) => {\r\n\t\t\tlet target = _.find(targets, (target) => {\r\n\t\t\t\treturn target.alias == s.alias || target.target == s.alias;\r\n\t\t\t});\r\n\r\n\t\t\tif (!target) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\ts.alias = target.alias;\r\n\t\t\ts.url = target.url;\r\n\t\t\ts.display = true;\r\n\t\t\ts.displayType = target.displayType;\r\n\t\t\ts.valueDisplayRegex = \"\";\r\n\r\n\t\t\tif(this.validateRegex(target.valueDisplayRegex)) {\r\n\t\t\t\ts.valueDisplayRegex = target.valueDisplayRegex;\r\n\t\t\t}\r\n\r\n\t\t\tlet value;\r\n\t\t\tswitch (target.aggregation) {\r\n\t\t\t\tcase 'Max':\r\n\t\t\t\t\tvalue = _.max(s.datapoints, (point) => { return point[0]; })[0];\r\n\t\t\t\t\tvalue = s.stats.max;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 'Min':\r\n\t\t\t\t\tvalue = _.min(s.datapoints, (point) => { return point[0]; })[0];\r\n\t\t\t\t\tvalue = s.stats.min;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 'Sum':\r\n\t\t\t\t\tvalue = 0;\r\n\t\t\t\t\t_.each(s.datapoints, (point) => { value += point[0] });\r\n\t\t\t\t\tvalue = s.stats.total;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 'Avg':\r\n\t\t\t\t\tvalue = s.stats.avg;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 'First':\r\n\t\t\t\t\tvalue = s.datapoints[0][0];\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tdefault:\r\n\t\t\t\t\tvalue = s.datapoints[s.datapoints.length - 1][0];\r\n\t\t\t}\r\n\r\n\t\t\ts.display_value = value;\r\n\r\n\t\t\tif (target.valueHandler == \"Threshold\") {\r\n\t\t\t\tthis.handleThresholdStatus(s, target);\r\n\t\t\t}\r\n\t\t\telse if (target.valueHandler == \"Disable Criteria\") {\r\n\t\t\t\tthis.handleDisabledStatus(s,target);\r\n\t\t\t}\r\n\t\t\telse if (target.valueHandler == \"Text Only\") {\r\n\t\t\t\tthis.handleTextOnly(s, target);\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\tif(this.disabled.length > 0) {\r\n\t\t\tthis.crit = [];\r\n\t\t\tthis.warn = [];\r\n\t\t\tthis.display = [];\r\n\t\t}\r\n\r\n\t\tthis.autoFlip();\r\n\t\tthis.handleCssDisplay();\r\n\t\tthis.parseUri();\r\n\t}\r\n\r\n\tupgradeOldVersion() {\r\n\t\tlet targets = this.panel.targets;\r\n\r\n\t\t//Handle legacy code\r\n\t\t_.each(targets, (target) => {\r\n\t\t\tif(target.valueHandler == null) {\r\n\t\t\t\ttarget.valueHandler = target.displayType;\r\n\t\t\t\tif(target.valueHandler == \"Annotation\") {\r\n\t\t\t\t\ttarget.valueHandler = \"Text Only\"\r\n\t\t\t\t}\r\n\t\t\t\ttarget.displayType = this.displayTypes[0];\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\r\n\thandleThresholdStatus(series, target) {\r\n\t\tseries.thresholds = StatusPluginCtrl.parseThresholds(target);\r\n\t\tseries.inverted = series.thresholds.crit < series.thresholds.warn;\r\n\t\tseries.display = target.display;\r\n\r\n\t\tlet isCritical = false;\r\n\t\tlet isWarning = false;\r\n\t\tlet isCheckRanges = series.thresholds.warnIsNumber && series.thresholds.critIsNumber;\r\n\t\tif (isCheckRanges) {\r\n\t\t\tif (!series.inverted) {\r\n\t\t\t\tif (series.display_value >= series.thresholds.crit) {\r\n\t\t\t\t\tisCritical = true\r\n\t\t\t\t} else if (series.display_value >= series.thresholds.warn) {\r\n\t\t\t\t\tisWarning = true\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tif (series.display_value <= series.thresholds.crit) {\r\n\t\t\t\t\tisCritical = true\r\n\t\t\t\t} else if (series.display_value <= series.thresholds.warn) {\r\n\t\t\t\t\tisWarning = true\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tif (series.display_value == series.thresholds.crit) {\r\n\t\t\t\tisCritical = true\r\n\t\t\t} else if (series.display_value == series.thresholds.warn) {\r\n\t\t\t\tisWarning = true\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif(isCritical) {\r\n\t\t\tthis.crit.push(series);\r\n\t\t\tseries.displayType = this.displayTypes[0]\r\n\t\t} else if(isWarning) {\r\n\t\t\tthis.warn.push(series);\r\n\t\t\tseries.displayType = this.displayTypes[0]\r\n\t\t} else if (series.display) {\r\n\t\t\tif(series.displayType == \"Annotation\") {\r\n\t\t\t\tthis.annotation.push(series);\r\n\t\t\t} else {\r\n\t\t\t\tthis.display.push(series);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\thandleDisabledStatus(series, target) {\r\n\t\tseries.displayType = this.displayTypes[0];\r\n\t\tseries.disabledValue = target.disabledValue;\r\n\r\n\t\tif (series.display_value == series.disabledValue) {\r\n\t\t\tthis.disabled.push(series);\r\n\t\t}\r\n\t}\r\n\r\n\thandleTextOnly(series, target) {\r\n\t\tif(series.displayType == \"Annotation\") {\r\n\t\t\tthis.annotation.push(series);\r\n\t\t} else {\r\n\t\t\tthis.display.push(series);\r\n\t\t}\r\n\t}\r\n\r\n\thandleCssDisplay() {\r\n\t\tthis.$panelContainer.removeClass('error-state warn-state disabled-state ok-state no-data-state');\r\n\r\n\t\tif(this.duplicates) {\r\n\t\t\tthis.$panelContainer.addClass('error-state');\r\n\t\t} else if (this.disabled.length > 0) {\r\n\t\t\tthis.$panelContainer.addClass('disabled-state');\r\n\t\t} else if (this.crit.length > 0) {\r\n\t\t\tthis.$panelContainer.addClass('error-state');\r\n\t\t} else if (this.warn.length > 0) {\r\n\t\t\tthis.$panelContainer.addClass('warn-state');\r\n\t\t} else if((this.series == undefined || this.series.length == 0) && this.panel.isGrayOnNoData) {\r\n\t\t\tthis.$panelContainer.addClass('no-data-state');\r\n\t\t} else {\r\n\t\t    if (!this.panel.useDefaultBackground)\r\n\t\t        this.$panelContainer.addClass('ok-state');\r\n\t\t}\r\n\t}\r\n\r\n\tparseUri() {\r\n\t\tif (this.panel.links && this.panel.links.length > 0) {\r\n\t\t\tthis.uri = this.panel.links[0].dashUri + \"?\" + this.panel.links[0].params;\r\n\t\t} else {\r\n\t\t\tthis.uri = undefined;\r\n\t\t}\r\n\t}\r\n\r\n\tvalidateRegex(textRegex) {\r\n\t\tif(textRegex == null || textRegex.length == 0) {\r\n\t\t\treturn true\r\n\t\t}\r\n\t\ttry {\r\n\t\t\tlet regex = new RegExp(textRegex);\r\n\t\t\treturn true\r\n\t\t} catch(e) {\r\n\t\t\treturn false\r\n\t\t}\r\n\t}\r\n\r\n\tstatic parseThresholds(metricOptions) {\r\n\t\tlet res = {};\r\n\r\n\t\tres.warnIsNumber = StatusPluginCtrl.isFloat(metricOptions.warn)\r\n\t\tif(res.warnIsNumber) {\r\n\t\t\tres.warn = parseFloat(metricOptions.warn);\r\n\t\t} else {\r\n\t\t\tres.warn = metricOptions.warn;\r\n\t\t}\r\n\r\n\t\tres.critIsNumber = StatusPluginCtrl.isFloat(metricOptions.crit);\r\n\t\tif(res.critIsNumber) {\r\n\t\t\tres.crit = parseFloat(metricOptions.crit);\r\n\t\t} else {\r\n\t\t\tres.crit = metricOptions.crit;\r\n\t\t}\r\n\r\n\t\treturn res;\r\n\t}\r\n\r\n\tstatic isFloat(val) {\r\n\t\tif (!isNaN(val) && val.toString().toLowerCase().indexOf('e') == -1) {\r\n\t\t\treturn true;\r\n\t\t}\r\n\t\treturn false;\r\n\t}\r\n\r\n\tonDataReceived(dataList) {\r\n\t\tthis.series = dataList.map(StatusPluginCtrl.seriesHandler.bind(this));\r\n\t\tthis.render();\r\n\t}\r\n\r\n\tonDataError() {\r\n\t\tthis.crit = [];\r\n\t\tthis.warn = [];\r\n\t}\r\n\r\n\tstatic seriesHandler(seriesData) {\r\n\t\tvar series = new TimeSeries({\r\n\t\t\tdatapoints: seriesData.datapoints,\r\n\t\t\talias: seriesData.target\r\n\t\t});\r\n\r\n\t\tseries.flotpairs = series.getFlotPairs(\"connected\");\r\n\r\n\t\treturn series;\r\n\t}\r\n\r\n\t$onDestroy() {\r\n\t\tif(this.timeoutId) clearInterval(this.timeoutId);\r\n\t}\r\n\r\n\tautoFlip() {\r\n\t\tif (this.timeoutId) clearInterval(this.timeoutId);\r\n\t\tif (this.panel.flipCard && (this.crit.length > 0 || this.warn.length > 0 || this.disabled.length > 0)) {\r\n\t\t\tthis.timeoutId = setInterval(() => {\r\n\t\t\t\tthis.$panelContainer.toggleClass(\"flipped\");\r\n\t\t\t}, this.panel.flipTime * 1000);\r\n\t\t}\r\n\t}\r\n\r\n\tlink(scope, elem, attrs, ctrl) {\r\n\t\tthis.$panelContainer = elem.find('.panel-container');\r\n\t\tthis.$panelContainer.addClass(\"st-card\");\r\n\t\tthis.$panelContoller = ctrl;\r\n\t}\r\n}\r\n\r\nStatusPluginCtrl.templateUrl = 'module.html';\r\n"]}